name: Mobb fix from CodeQL reports

on:
  workflow_run:
    workflows: ["CodeQL"] # This workflow is triggered when the name specified here is triggered. In CodeQL Default Code Scanning Setup, this name is "CodeQL", if you are using CodeQL Advanced Setup, you may need to change this if you have a different workflow name. 
    types:
      - completed
      

jobs:
  handle_codeql_scan:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' && contains(github.event.workflow_run.head_branch,'refs/pull') }} # Check if workflow is a Pull Request Event and not a Push event
    permissions:
      pull-requests: write
      security-events: write
      statuses: write
      contents: write
      issues: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: 
        run: |
          
          echo "github.event.workflow_run.head_branch = " ${{ github.event.workflow_run.head_branch }}
          echo "contains(github.event.workflow_run.head_branch,'refs/pull') = " ${{ contains(github.event.workflow_run.head_branch,'refs/pull') }}
          echo $(curl --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' -s ${{github.event.workflow_run.repository.url}}/pulls/50 | jq -r '.head.ref')

          env
        shell: bash -l {0}
      - uses: mobb-dev/codeql-mobb-fixer-action@main
        with:
          mobb-api-token: ${{ secrets.MOBB_API_TOKEN }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
